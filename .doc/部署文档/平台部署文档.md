# EasyAIoT Platform Deployment Documentation

## üìã Table of Contents

- [Overview](#overview)
- [Environment Requirements](#environment-requirements)
- [Quick Start](#quick-start)
- [Script Usage](#script-usage)
- [Module Description](#module-description)
- [Service Ports](#service-ports)
- [Common Issues](#common-issues)
- [Log Management](#log-management)

## Overview

EasyAIoT is a cloud-edge integrated intelligent algorithm application platform that uses a unified installation script for one-click deployment. The platform supports Docker containerized deployment and can quickly install and start all service modules.

### Platform Architecture

The EasyAIoT platform consists of the following core modules:

- **Base Services** (`.scripts/docker`): Includes middleware services such as Nacos, PostgreSQL, Redis, TDEngine, Kafka, MinIO
- **DEVICE Service**: Device management and gateway service (based on Java)
- **AI Service**: Artificial intelligence processing service (based on Python)
- **VIDEO Service**: Video processing service (based on Python)
- **WEB Service**: Web frontend service (based on Vue)

## Environment Requirements

### System Requirements

- **Operating System**: 
  - Linux (recommended Ubuntu 24.04)
  - macOS (recommended macOS 10.15+)
  - Windows (recommended Windows 10/11, requires PowerShell 5.1+)
- **Memory**: Recommended 32GB (minimum 16GB)
- **Disk**: Recommended 50GB or more available space
- **CPU**: Recommended 8 cores (minimum 4 cores)
- **Graphics Card**: Recommended NVIDIA GPU (minimum CPU)

### Software Dependencies

Before running the deployment script, ensure the following software is installed:

1. **Docker** (Required version v29.0.0+)
   - Installation guide: https://docs.docker.com/get-docker/
   - Verify installation: `docker --version`
   - **Note**: Docker version must be v29.0.0 or higher, versions below this will not work properly

2. **Docker Compose** (Required version v2.35.0+)
   - Installation guide: https://docs.docker.com/compose/install/
   - Verify installation: `docker compose version`
   - **Note**: Docker Compose version must be v2.35.0 or higher, versions below this will not work properly

3. **Other Dependencies**:
   - **Linux/macOS**: `curl` (for health checks, usually pre-installed)
   - **Windows**: PowerShell 5.1+ (usually pre-installed)

### Docker Permission Configuration

#### Linux

Ensure the current user has permission to access the Docker daemon:

```bash
# Method 1: Add user to docker group (recommended)
sudo usermod -aG docker $USER
# Then re-login or run
newgrp docker

# Method 2: Use sudo to run script (not recommended)
sudo ./install_linux.sh [command]
```

Verify Docker permissions:

```bash
docker ps
```

#### macOS

macOS usually doesn't require special permission configuration, Docker Desktop handles permissions automatically.

#### Windows

On Windows, Docker Desktop handles permissions automatically. Ensure PowerShell is run as administrator if needed.

## Quick Start

### Linux Deployment

#### 1. Get Project Code

```bash
# Clone project (if not already done)
git clone <repository-url>
cd easyaiot
```

#### 2. Navigate to Script Directory

```bash
cd .scripts/docker
```

#### 3. Grant Execute Permission

```bash
chmod +x install_linux.sh
```

#### 4. One-Click Install All Services

```bash
./install_linux.sh install
```

This command will:
- Check Docker and Docker Compose environment
- Create unified network `easyaiot-network`
- Install all modules in dependency order
- Start all service containers

#### 5. Verify Service Status

```bash
./install_linux.sh verify
```

If all services are running normally, service access addresses will be displayed.

### macOS Deployment

#### 1. Get Project Code

```bash
# Clone project (if not already done)
git clone <repository-url>
cd easyaiot
```

#### 2. Navigate to Script Directory

```bash
cd .scripts/docker
```

#### 3. Grant Execute Permission

```bash
chmod +x install_mac.sh
```

#### 4. One-Click Install All Services

```bash
./install_mac.sh install
```

This command will:
- Check Docker and Docker Compose environment
- Create unified network `easyaiot-network`
- Install all modules in dependency order
- Start all service containers

#### 5. Verify Service Status

```bash
./install_mac.sh verify
```

If all services are running normally, service access addresses will be displayed.

### Windows Deployment

#### 1. Get Project Code

```powershell
# Clone project (if not already done)
git clone <repository-url>
cd easyaiot
```

#### 2. Navigate to Script Directory

```powershell
cd .scripts\docker
```

#### 3. Set Execution Policy (if needed)

If running PowerShell scripts for the first time, you may need to set execution policy:

```powershell
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```

#### 4. One-Click Install All Services

```powershell
.\install_win.ps1 install
```

This command will:
- Check Docker and Docker Compose environment
- Create unified network `easyaiot-network`
- Install all modules in dependency order
- Start all service containers

#### 5. Verify Service Status

```powershell
.\install_win.ps1 verify
```

If all services are running normally, service access addresses will be displayed.

## Script Usage

### Script Location

Unified installation scripts are located in the `.scripts/docker/` directory under the project root:

- **Linux**: `install_linux.sh`
- **macOS**: `install_mac.sh`
- **Windows**: `install_win.ps1`

### Available Commands

All operating systems support the same commands, but script names differ:

| Command | Description | Linux Example | macOS Example | Windows Example |
|---------|-------------|---------------|---------------|-----------------|
| `install` | Install and start all services (first run) | `./install_linux.sh install` | `./install_mac.sh install` | `.\install_win.ps1 install` |
| `start` | Start all services | `./install_linux.sh start` | `./install_mac.sh start` | `.\install_win.ps1 start` |
| `stop` | Stop all services | `./install_linux.sh stop` | `./install_mac.sh stop` | `.\install_win.ps1 stop` |
| `restart` | Restart all services | `./install_linux.sh restart` | `./install_mac.sh restart` | `.\install_win.ps1 restart` |
| `status` | View all service status | `./install_linux.sh status` | `./install_mac.sh status` | `.\install_win.ps1 status` |
| `logs` | View all service logs | `./install_linux.sh logs` | `./install_mac.sh logs` | `.\install_win.ps1 logs` |
| `build` | Rebuild all images | `./install_linux.sh build` | `./install_mac.sh build` | `.\install_win.ps1 build` |
| `clean` | Clean all containers and images (dangerous) | `./install_linux.sh clean` | `./install_mac.sh clean` | `.\install_win.ps1 clean` |
| `update` | Update and restart all services | `./install_linux.sh update` | `./install_mac.sh update` | `.\install_win.ps1 update` |
| `verify` | Verify all services started successfully | `./install_linux.sh verify` | `./install_mac.sh verify` | `.\install_win.ps1 verify` |

### Command Details

#### install - Install Services

Used for first deployment, installs and starts all service modules:

**Linux/macOS**:
```bash
./install_linux.sh install    # Linux
./install_mac.sh install       # macOS
```

**Windows**:
```powershell
.\install_win.ps1 install
```

**Execution Process**:
1. Check Docker and Docker Compose environment
2. Create Docker network `easyaiot-network`
3. Install modules in dependency order:
   - Base services (Nacos, PostgreSQL, Redis, etc.)
   - DEVICE service
   - AI service
   - VIDEO service
   - WEB service
4. Display installation result statistics

#### start - Start Services

Start all installed services:

**Linux/macOS**:
```bash
./install_linux.sh start    # Linux
./install_mac.sh start      # macOS
```

**Windows**:
```powershell
.\install_win.ps1 start
```

#### stop - Stop Services

Stop all running services (in reverse order):

**Linux/macOS**:
```bash
./install_linux.sh stop    # Linux
./install_mac.sh stop      # macOS
```

**Windows**:
```powershell
.\install_win.ps1 stop
```

#### restart - Restart Services

Restart all services:

**Linux/macOS**:
```bash
./install_linux.sh restart    # Linux
./install_mac.sh restart      # macOS
```

**Windows**:
```powershell
.\install_win.ps1 restart
```

#### status - View Status

View running status of all services:

**Linux/macOS**:
```bash
./install_linux.sh status    # Linux
./install_mac.sh status      # macOS
```

**Windows**:
```powershell
.\install_win.ps1 status
```

#### logs - View Logs

View logs of all services (last 100 lines):

**Linux/macOS**:
```bash
./install_linux.sh logs    # Linux
./install_mac.sh logs      # macOS
```

**Windows**:
```powershell
.\install_win.ps1 logs
```

#### build - Build Images

Rebuild Docker images for all services (using `--no-cache` option):

**Linux/macOS**:
```bash
./install_linux.sh build    # Linux
./install_mac.sh build      # macOS
```

**Windows**:
```powershell
.\install_win.ps1 build
```

**Note**: The build process may take a long time, please be patient.

#### clean - Clean Services

**‚ö†Ô∏è Dangerous Operation**: Delete all containers, images, and data volumes

**Linux/macOS**:
```bash
./install_linux.sh clean    # Linux
./install_mac.sh clean      # macOS
```

**Windows**:
```powershell
.\install_win.ps1 clean
```

Confirmation will be required before execution. Enter `y` or `Y` to continue, other inputs will cancel the operation.

**Cleanup Contents**:
- All service containers
- All service images
- All data volumes
- Docker network `easyaiot-network`

#### update - Update Services

Pull latest images and restart all services:

**Linux/macOS**:
```bash
./install_linux.sh update    # Linux
./install_mac.sh update      # macOS
```

**Windows**:
```powershell
.\install_win.ps1 update
```

**Execution Process**:
1. Pull latest images for each module
2. Restart all services to use new images

#### verify - Verify Services

Verify all services are started normally and accessible:

**Linux/macOS**:
```bash
./install_linux.sh verify    # Linux
./install_mac.sh verify      # macOS
```

**Windows**:
```powershell
.\install_win.ps1 verify
```

**Verification Content**:
- Check if service ports are accessible
- Check if health check endpoints respond normally
- Display service access addresses

**Success Output Example**:
```
[SUCCESS] All services are running normally!

Service Access Addresses:
  Base Service (Nacos):     http://localhost:8848/nacos
  Base Service (MinIO):     http://localhost:9000 (API), http://localhost:9001 (Console)
  Device Service (Gateway):  http://localhost:48080
  AI Service:                http://localhost:5000
  Video Service:             http://localhost:6000
  Web Frontend:               http://localhost:8888
```

## Module Description

### Base Services (`.scripts/docker`)

**Description**: Contains all middleware services required for platform operation

**Included Services**:
- **Nacos**: Service registration and configuration center
- **PostgreSQL**: Relational database
- **Redis**: Cache database
- **TDEngine**: Time-series database
- **Kafka**: Message queue
- **MinIO**: Object storage service

**Deployment Method**: 
- **Linux**: Use `install_middleware_linux.sh` script
- **macOS**: Use `install_middleware_mac.sh` script
- **Windows**: Use `install_middleware_win.ps1` script

### DEVICE Service

**Description**: Device management and gateway service, providing device access, product management, data labeling, rule engine, etc.

**Technology Stack**: Java (Spring Cloud)

**Deployment Method**: 
- **Linux**: Use `install_linux.sh` script
- **macOS**: Use `install_mac.sh` script
- **Windows**: Use `install_win.ps1` script

**Main Features**:
- Device management
- Product management
- Data labeling
- Rule engine
- Algorithm store
- System management

### AI Service

**Description**: Artificial intelligence processing service, responsible for video analysis and AI algorithm execution

**Technology Stack**: Python

**Deployment Method**: 
- **Linux**: Use `install_linux.sh` script
- **macOS**: Use `install_mac.sh` script
- **Windows**: Use `install_win.ps1` script

**Main Features**:
- Video analysis
- AI algorithm execution
- Model inference

### VIDEO Service

**Description**: Video processing service, responsible for video stream processing and transmission

**Technology Stack**: Python

**Deployment Method**: 
- **Linux**: Use `install_linux.sh` script
- **macOS**: Use `install_mac.sh` script
- **Windows**: Use `install_win.ps1` script

**Main Features**:
- Video stream processing
- Video transmission
- Streaming service

### WEB Service

**Description**: Web frontend service, providing user interface

**Technology Stack**: Vue.js

**Deployment Method**: 
- **Linux**: Use `install_linux.sh` script
- **macOS**: Use `install_mac.sh` script
- **Windows**: Use `install_win.ps1` script

**Main Features**:
- User interface
- Data visualization
- System management interface

## Service Ports

| Service Module | Port | Description | Access Address |
|----------------|------|-------------|----------------|
| Nacos | 8848 | Service registration and configuration center | http://localhost:8848/nacos |
| MinIO API | 9000 | Object storage API | http://localhost:9000 |
| MinIO Console | 9001 | Object storage console | http://localhost:9001 |
| DEVICE Gateway | 48080 | Device service gateway | http://localhost:48080 |
| AI Service | 5000 | AI processing service | http://localhost:5000 |
| VIDEO Service | 6000 | Video processing service | http://localhost:6000 |
| WEB Frontend | 8888 | Web frontend interface | http://localhost:8888 |

### Health Check Endpoints

Health check endpoints for each service:

| Service Module | Health Check Endpoint |
|----------------|----------------------|
| Base Service (Nacos) | `/nacos/actuator/health` |
| DEVICE Service | `/actuator/health` |
| AI Service | `/actuator/health` |
| VIDEO Service | `/actuator/health` |
| WEB Service | `/health` |

## Common Issues

### 1. Docker Permission Issues

**Problem**: Script execution prompts "no permission to access Docker daemon"

**Solution**:

**Linux**:
```bash
# Add user to docker group
sudo usermod -aG docker $USER

# Re-login or run
newgrp docker

# Verify permissions
docker ps
```

**macOS**: 
macOS usually doesn't require special configuration, just ensure Docker Desktop is running.

**Windows**: 
On Windows, Docker Desktop handles permissions automatically. Ensure Docker Desktop is running.

### 2. Port Already in Use

**Problem**: Service startup prompts that port is already in use

**Solution**:

**Linux**:
```bash
# Check port usage
sudo netstat -tulpn | grep <port>
# or
sudo lsof -i :<port>

# Stop the process using the port or modify the port in service configuration
```

**macOS**:
```bash
# Check port usage
lsof -i :<port>

# Stop the process using the port or modify the port in service configuration
```

**Windows**:
```powershell
# Check port usage
netstat -ano | findstr :<port>

# Stop the process using the port or modify the port in service configuration
```

### 3. Service Startup Failure

**Problem**: A service module fails to start

**Solution**:

**Linux/macOS**:
```bash
# 1. View service logs
./install_linux.sh logs    # Linux
./install_mac.sh logs      # macOS

# 2. View detailed logs for specific module
cd <module-directory>
docker-compose logs

# 3. Check Docker resources
docker ps -a
docker images

# 4. Check network
docker network ls
docker network inspect easyaiot-network
```

**Windows**:
```powershell
# 1. View service logs
.\install_win.ps1 logs

# 2. View detailed logs for specific module
cd <module-directory>
docker-compose logs

# 3. Check Docker resources
docker ps -a
docker images

# 4. Check network
docker network ls
docker network inspect easyaiot-network
```

### 4. Image Build Failure

**Problem**: Image build fails

**Solution**:

**Linux/macOS**:
```bash
# 1. Check Docker disk space
docker system df

# 2. Clean unused resources
docker system prune -a

# 3. Check network connection (if pulling base images)
ping registry-1.docker.io

# 4. Build image for failed module separately
cd <module-directory>
docker-compose build --no-cache
```

**Windows**:
```powershell
# 1. Check Docker disk space
docker system df

# 2. Clean unused resources
docker system prune -a

# 3. Check network connection (if pulling base images)
Test-NetConnection registry-1.docker.io -Port 443

# 4. Build image for failed module separately
cd <module-directory>
docker-compose build --no-cache
```

### 5. Service Unreachable

**Problem**: Service is started but cannot be accessed via browser

**Solution**:

**Linux**:
```bash
# 1. Verify service is running normally
./install_linux.sh verify

# 2. Check firewall settings
sudo ufw status
# If need to open port
sudo ufw allow <port>

# 3. Check service logs
./install_linux.sh logs

# 4. Check container status
docker ps
```

**macOS**:
```bash
# 1. Verify service is running normally
./install_mac.sh verify

# 2. Check firewall settings (System Preferences > Security & Privacy > Firewall)

# 3. Check service logs
./install_mac.sh logs

# 4. Check container status
docker ps
```

**Windows**:
```powershell
# 1. Verify service is running normally
.\install_win.ps1 verify

# 2. Check firewall settings (Windows Firewall Settings)

# 3. Check service logs
.\install_win.ps1 logs

# 4. Check container status
docker ps
```

### 6. Data Loss Issue

**Problem**: Data lost after cleaning services

**Description**: The `clean` command will delete all data volumes, causing data loss. This is expected behavior.

**Prevention Measures**:
- Backup important data before executing `clean`
- Use `clean` command cautiously in production environment
- Recommend using data volume backup tools

## Log Management

### Log File Location

Script execution logs are saved in the `.scripts/docker/logs/` directory:

- **Linux**: `install_linux_YYYYMMDD_HHMMSS.log`
- **macOS**: `install_mac_YYYYMMDD_HHMMSS.log`
- **Windows**: `install_win_YYYYMMDD_HHMMSS.log`

Log file names include timestamps for easy distinction between different execution records.

### View Logs

#### View Script Execution Logs

**Linux/macOS**:
```bash
# View latest log files
ls -lt .scripts/docker/logs/ | head -5

# View specific log file
tail -f .scripts/docker/logs/install_linux_20240101_120000.log    # Linux
tail -f .scripts/docker/logs/install_mac_20240101_120000.log      # macOS
```

**Windows**:
```powershell
# View latest log files
Get-ChildItem .scripts\docker\logs\ | Sort-Object LastWriteTime -Descending | Select-Object -First 5

# View specific log file
Get-Content .scripts\docker\logs\install_win_20240101_120000.log -Wait
```

#### View Service Container Logs

**Linux/macOS**:
```bash
# View all service logs
./install_linux.sh logs    # Linux
./install_mac.sh logs      # macOS

# View logs for specific service (need to enter corresponding module directory)
cd DEVICE
docker-compose logs -f
```

**Windows**:
```powershell
# View all service logs
.\install_win.ps1 logs

# View logs for specific service (need to enter corresponding module directory)
cd DEVICE
docker-compose logs -f
```

### Log Content

Script logs include:
- Execution timestamps
- Executed commands
- Execution results for each module
- Error messages and warnings
- Service status information

## Deployment Process Recommendations

### First Deployment

#### Linux

1. **Environment Preparation**
   ```bash
   # Check system requirements
   uname -a
   free -h
   df -h
   
   # Install Docker and Docker Compose
   # Reference: https://docs.docker.com/get-docker/
   ```

2. **Get Code**
   ```bash
   git clone <repository-url>
   cd easyaiot
   ```

3. **Execute Installation**
   ```bash
   cd .scripts/docker
   chmod +x install_linux.sh
   ./install_linux.sh install
   ```

4. **Verify Deployment**
   ```bash
   ./install_linux.sh verify
   ```

5. **Access Services**
   - Open browser and access each service address
   - Check if services are running normally

#### macOS

1. **Environment Preparation**
   ```bash
   # Check system requirements
   uname -a
   system_profiler SPHardwareDataType | grep Memory
   df -h
   
   # Install Docker Desktop for Mac
   # Reference: https://docs.docker.com/desktop/install/mac-install/
   ```

2. **Get Code**
   ```bash
   git clone <repository-url>
   cd easyaiot
   ```

3. **Execute Installation**
   ```bash
   cd .scripts/docker
   chmod +x install_mac.sh
   ./install_mac.sh install
   ```

4. **Verify Deployment**
   ```bash
   ./install_mac.sh verify
   ```

5. **Access Services**
   - Open browser and access each service address
   - Check if services are running normally

#### Windows

1. **Environment Preparation**
   ```powershell
   # Check system requirements
   systeminfo | findstr /C:"OS Name" /C:"Total Physical Memory"
   
   # Install Docker Desktop for Windows
   # Reference: https://docs.docker.com/desktop/install/windows-install/
   ```

2. **Get Code**
   ```powershell
   git clone <repository-url>
   cd easyaiot
   ```

3. **Execute Installation**
   ```powershell
   cd .scripts\docker
   .\install_win.ps1 install
   ```

4. **Verify Deployment**
   ```powershell
   .\install_win.ps1 verify
   ```

5. **Access Services**
   - Open browser and access each service address
   - Check if services are running normally

### Daily Operations

#### Linux/macOS

1. **Start Services**
   ```bash
   ./install_linux.sh start    # Linux
   ./install_mac.sh start      # macOS
   ```

2. **Stop Services**
   ```bash
   ./install_linux.sh stop    # Linux
   ./install_mac.sh stop      # macOS
   ```

3. **Restart Services**
   ```bash
   ./install_linux.sh restart    # Linux
   ./install_mac.sh restart      # macOS
   ```

4. **View Status**
   ```bash
   ./install_linux.sh status    # Linux
   ./install_mac.sh status      # macOS
   ```

5. **View Logs**
   ```bash
   ./install_linux.sh logs    # Linux
   ./install_mac.sh logs      # macOS
   ```

#### Windows

1. **Start Services**
   ```powershell
   .\install_win.ps1 start
   ```

2. **Stop Services**
   ```powershell
   .\install_win.ps1 stop
   ```

3. **Restart Services**
   ```powershell
   .\install_win.ps1 restart
   ```

4. **View Status**
   ```powershell
   .\install_win.ps1 status
   ```

5. **View Logs**
   ```powershell
   .\install_win.ps1 logs
   ```

### Update Deployment

#### Linux/macOS

1. **Pull Latest Code**
   ```bash
   git pull
   ```

2. **Update Services**
   ```bash
   cd .scripts/docker
   ./install_linux.sh update    # Linux
   ./install_mac.sh update      # macOS
   ```

3. **Verify Update**
   ```bash
   ./install_linux.sh verify    # Linux
   ./install_mac.sh verify      # macOS
   ```

#### Windows

1. **Pull Latest Code**
   ```powershell
   git pull
   ```

2. **Update Services**
   ```powershell
   cd .scripts\docker
   .\install_win.ps1 update
   ```

3. **Verify Update**
   ```powershell
   .\install_win.ps1 verify
   ```

## Important Notes

1. **Version Requirements**: **Must** install Docker v29.0.0+ and Docker Compose v2.35.0+, versions below this will not work properly
2. **Network Requirements**: Ensure server can access Docker Hub or configured image registry
3. **Resource Requirements**: Ensure server has sufficient CPU, memory, and disk space
4. **Port Conflicts**: Ensure required ports are not occupied by other services
5. **Data Backup**: Please backup data before production deployment
6. **Security Configuration**: Please configure firewall and security group rules for production environment
7. **Log Management**: Regularly clean old log files to avoid disk space shortage

## Technical Support

If you encounter problems, please:

1. Check the [Common Issues](#common-issues) section of this document
2. View service logs: `./install_all.sh logs`
3. Check Docker status: `docker ps -a`
4. Submit an Issue to the project repository

---

**Document Version**: 1.0  
**Last Updated**: 2024-01-01  
**Script Location**: `.scripts/docker/install_all.sh`

