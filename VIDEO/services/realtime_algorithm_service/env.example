# ============================================
# 实时算法服务环境变量配置模板
# ============================================
# 使用方法：
# 1. 复制此文件为 .env: cp env.example .env
# 2. 根据实际情况修改各个配置项
# 3. 注意：.env 文件包含敏感信息，不要提交到版本控制系统
# ============================================

# ============================================
# 基本配置（必需）
# ============================================
# 算法任务ID（必需）
TASK_ID=

# 数据库配置
DATABASE_URL=postgresql://postgres:iot45722414822@localhost:5432/iot-video

# 视频服务端口（默认6000）
VIDEO_SERVICE_PORT=6000

# 网关地址（用于构建完整的告警hook URL，默认http://localhost:48080）
GATEWAY_URL=http://localhost:48080

# ============================================
# 视频处理配置（可选，用于优化CPU占用和推流速度）
# ============================================
# 视频帧率（默认15fps，原25fps，降低可减少CPU占用和推流速度）
SOURCE_FPS=15

# 视频分辨率宽度（默认640，原1280，降低可大幅减少CPU占用和推流速度）
TARGET_WIDTH=640

# 视频分辨率高度（默认360，原720，降低可大幅减少CPU占用和推流速度）
TARGET_HEIGHT=360

# 抽帧间隔（默认5，表示每5帧抽取一帧进行检测）
EXTRACT_INTERVAL=5

# 帧缓存大小（默认70）
BUFFER_SIZE=70

# 最小缓存帧数（默认15）
MIN_BUFFER_FRAMES=15

# 最大等待时间（秒，默认0.08）
MAX_WAIT_TIME=0.08

# YOLO检测分辨率（默认416，原640，降低可减少CPU占用）
YOLO_IMG_SIZE=416

# ============================================
# FFmpeg编码配置（可选，用于优化CPU占用和推流速度）
# ============================================
# FFmpeg编码预设（默认ultrafast，最快编码，CPU占用最低）
# 可选值：ultrafast, superfast, veryfast, faster, fast, medium, slow, slower, veryslow
# 注意：预设越快，CPU占用越低，但压缩率也越低
FFMPEG_PRESET=ultrafast

# FFmpeg视频比特率（默认500k，原1500k，降低可减少推流速度）
# 格式：数字+k（如500k）或数字（如500000）
# 注意：不能为空，如果为空会自动使用默认值500k
FFMPEG_VIDEO_BITRATE=500k

# FFmpeg编码线程数（默认不设置，表示自动）
# 如果CPU占用过高，可以设置为较小值（如2或4）来限制线程数
# 注意：设置为空字符串或不设置表示自动，代码会自动处理空值
FFMPEG_THREADS=

# FFmpeg GOP大小（关键帧间隔，默认不设置，自动计算为SOURCE_FPS*2）
# 如果设置了SOURCE_FPS=15，则默认GOP=30（2秒一个关键帧）
# 可以手动设置，但建议保持默认值（不设置）
FFMPEG_GOP_SIZE=

# ============================================
# 队列配置（可选，用于优化高负载场景）
# ============================================
# 检测队列大小（默认100，原50，增大可减少队列满的错误）
# 如果遇到"检测队列已满"警告，可以适当增大此值
DETECTION_QUEUE_SIZE=100

# 推帧队列大小（默认100，原50，增大可减少队列满的错误）
# 如果遇到"推帧队列已满"警告，可以适当增大此值
PUSH_QUEUE_SIZE=100

# 抽帧队列大小（默认50）
EXTRACT_QUEUE_SIZE=50

# YOLO检测工作线程数量（默认2，原1，增大可提升处理能力）
# 如果检测速度跟不上，可以适当增加此值（建议2-4个）
# 注意：线程数过多可能增加CPU占用
YOLO_WORKER_THREADS=2

# ============================================
# 其他配置
# ============================================
# Python输出不缓冲（建议设置为1）
PYTHONUNBUFFERED=1

# 时区设置
TZ=Asia/Shanghai

