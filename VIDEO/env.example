# ============================================
# VIDEO服务环境变量配置模板
# ============================================
# 使用方法：
# 1. 复制此文件为 .env: cp env.example .env
# 2. 根据实际情况修改各个配置项
# 3. 注意：.env 文件包含敏感信息，不要提交到版本控制系统
# ============================================

# ============================================
# Flask应用配置
# ============================================
# Flask密钥（用于会话加密，请使用强随机字符串）
SECRET_KEY=your-secret-key-please-change-this-to-a-random-string

# Flask运行端口（默认6000）
FLASK_RUN_PORT=6000

# Flask运行主机（默认0.0.0.0）
FLASK_RUN_HOST=0.0.0.0

# Flask调试模式（生产环境建议设置为False）
DEBUG=False

# 允许的主机列表
ALLOWED_HOSTS=[*]

# ============================================
# 数据库配置
# ============================================
# PostgreSQL数据库连接URL
# 格式: postgresql://用户名:密码@主机:端口/数据库名
# 注意：如果使用postgres://开头，代码会自动转换为postgresql://
# 在Docker环境中，使用容器服务名称：PostgresSQL（参考install_middleware_linux.sh）
# 数据库名：iot-video20（由中间件安装脚本创建）
DATABASE_URL=postgresql://postgres:iot45722414822@PostgresSQL:5432/iot-video20

# ============================================
# Nacos服务注册与发现配置
# ============================================
# Nacos服务器地址（格式：IP:端口 或 服务名称:端口）
# 在Docker环境中，使用容器服务名称：Nacos（参考install_middleware_linux.sh）
NACOS_SERVER=Nacos:8848

# Nacos命名空间（默认：空字符串，使用默认命名空间public）
NACOS_NAMESPACE=

# Nacos用户名（默认：nacos）
NACOS_USERNAME=nacos

# Nacos密码
NACOS_PASSWORD=basiclab@iot78475418754

# 服务名称（用于Nacos注册）
SERVICE_NAME=video-server

# Pod IP地址（可选，如果不设置会自动获取）
# 在Docker容器中运行时，建议设置为容器的IP地址
POD_IP=

# ============================================
# MinIO对象存储配置
# ============================================
# MinIO服务器地址（格式：IP:端口 或 服务名称:端口）
# 在Docker环境中，使用容器服务名称：MinIO（参考install_middleware_linux.sh）
MINIO_ENDPOINT=MinIO:9000

# MinIO访问密钥
MINIO_ACCESS_KEY=minioadmin

# MinIO密钥（由中间件安装脚本设置）
MINIO_SECRET_KEY=basiclab@iot975248395

# MinIO是否使用HTTPS（true/false）
MINIO_SECURE=false

# ============================================
# 视频服务特有配置
# ============================================
# 模型推流地址（RTMP服务器地址）
MODEL_AI_PUSH_URL=pro.basiclab.top:1935

# 摄像头存活检测时间间隔（秒）
CAMERA_ONLINE_INTERVAL=10

# 扫描设备IP变更时间间隔（秒）
CAMERA_DISCOVER_INTERVAL=60

# ONVIF WSDL目录（可选）
# ONVIF_WSDL_DIR=/etc/onvif/wsdl

# ============================================
# 实时算法服务队列配置（可选，用于优化高负载场景）
# ============================================
# 检测队列大小（默认100，原50，增大可减少队列满的错误）
# 如果遇到"检测队列已满"警告，可以适当增大此值
DETECTION_QUEUE_SIZE=100

# 推帧队列大小（默认100，原50，增大可减少队列满的错误）
# 如果遇到"推帧队列已满"警告，可以适当增大此值
PUSH_QUEUE_SIZE=100

# 抽帧队列大小（默认50）
EXTRACT_QUEUE_SIZE=50

# YOLO检测工作线程数量（默认2，原1，增大可提升处理能力）
# 如果检测速度跟不上，可以适当增加此值（建议2-4个）
# 注意：线程数过多可能增加CPU占用
YOLO_WORKER_THREADS=2

# ============================================
# 实时算法服务视频处理配置（可选，用于优化CPU占用和推流速度）
# ============================================
# 视频帧率（默认15fps，原25fps，降低可减少CPU占用和推流速度）
SOURCE_FPS=15

# 视频分辨率宽度（默认640，原1280，降低可大幅减少CPU占用和推流速度）
TARGET_WIDTH=640

# 视频分辨率高度（默认360，原720，降低可大幅减少CPU占用和推流速度）
TARGET_HEIGHT=360

# 抽帧间隔（默认5，表示每5帧抽取一帧进行检测）
EXTRACT_INTERVAL=5

# 帧缓存大小（默认70）
BUFFER_SIZE=70

# 最小缓存帧数（默认15）
MIN_BUFFER_FRAMES=15

# 最大等待时间（秒，默认0.08）
MAX_WAIT_TIME=0.08

# YOLO检测分辨率（默认416，原640，降低可减少CPU占用）
YOLO_IMG_SIZE=416

# ============================================
# FFmpeg编码配置（可选，用于优化CPU占用和推流速度）
# ============================================
# FFmpeg编码预设（默认ultrafast，最快编码，CPU占用最低）
# 可选值：ultrafast, superfast, veryfast, faster, fast, medium, slow, slower, veryslow
# 注意：预设越快，CPU占用越低，但压缩率也越低
FFMPEG_PRESET=ultrafast

# FFmpeg视频比特率（默认500k，原1500k，降低可减少推流速度）
# 格式：数字+k（如500k）或数字（如500000）
FFMPEG_VIDEO_BITRATE=500k

# FFmpeg编码线程数（默认不设置，表示自动）
# 如果CPU占用过高，可以设置为较小值（如2或4）来限制线程数
# 注意：设置为空字符串或不设置表示自动
FFMPEG_THREADS=

# FFmpeg GOP大小（关键帧间隔，默认不设置，自动计算为SOURCE_FPS*2）
# 如果设置了SOURCE_FPS=15，则默认GOP=30（2秒一个关键帧）
# 可以手动设置，但建议保持默认值
FFMPEG_GOP_SIZE=

# ============================================
# 其他配置
# ============================================
# Python输出不缓冲（建议设置为1）
PYTHONUNBUFFERED=1

# 时区设置
TZ=Asia/Shanghai

# ============================================
# Redis配置（可选，如果需要）
# ============================================
# Redis服务器地址（在Docker环境中，使用容器服务名称：Redis，参考install_middleware_linux.sh）
# REDIS_HOST=Redis
# REDIS_PORT=6379
# REDIS_PASSWORD=basiclab@iot975248395

# ============================================
# Kafka配置（可选，如果需要）
# ============================================
# Kafka服务器地址
# 注意：VIDEO服务使用host网络模式，必须使用宿主机IP或localhost，不能使用容器名
# 如果Kafka运行在宿主机上，使用：localhost:9092
# 如果Kafka运行在其他机器上，使用：<宿主机IP>:9092
# 支持多个服务器，用逗号分隔，例如：192.168.1.100:9092,192.168.1.101:9092
KAFKA_BOOTSTRAP_SERVERS=localhost:9092

# Kafka告警主题名称（实时算法任务使用）
KAFKA_ALERT_TOPIC=iot-alert-notification

# Kafka告警通知主题名称（实时算法任务使用，与KAFKA_ALERT_TOPIC相同）
KAFKA_ALERT_NOTIFICATION_TOPIC=iot-alert-notification

# Kafka抓拍算法任务告警主题名称（抓拍算法任务使用，区别于实时算法任务）
KAFKA_SNAPSHOT_ALERT_TOPIC=iot-snapshot-alert

# Kafka请求超时时间（毫秒，默认30000，即30秒）
# 增加超时时间可以提高连接稳定性，避免频繁断开
KAFKA_REQUEST_TIMEOUT_MS=30000

# Kafka重试次数（默认3）
# 增加重试次数可以提高消息发送成功率
KAFKA_RETRIES=3

# Kafka重试间隔（毫秒，默认1000，即1秒）
# 增加重试间隔可以避免频繁重试导致的问题
KAFKA_RETRY_BACKOFF_MS=1000

# Kafka元数据最大年龄（毫秒，默认300000，即5分钟）
KAFKA_METADATA_MAX_AGE_MS=300000

# Kafka连接建立超时（毫秒，默认10000，即10秒）
# 用于控制建立连接时的超时时间
KAFKA_SOCKET_CONNECTION_SETUP_TIMEOUT_MS=10000

# Kafka最大阻塞时间（毫秒，默认60000，即60秒）
# 用于控制send等操作的阻塞时间
KAFKA_MAX_BLOCK_MS=60000

# Kafka消息传递超时（毫秒，默认120000，即120秒）
# 用于控制消息从发送到确认的超时时间
KAFKA_DELIVERY_TIMEOUT_MS=120000

# Kafka初始化失败后重试间隔（秒，默认60）
KAFKA_INIT_RETRY_INTERVAL=60

# ============================================
# TDengine配置（可选，如果需要）
# ============================================
# TDengine服务器地址（在Docker环境中，使用容器服务名称：TDengine，参考install_middleware_linux.sh）
# TDENGINE_HOST=TDengine
# TDENGINE_PORT=6030

# ============================================
# 阿里云百炼平台配置（用于 QwenVL3 视觉推理）
# ============================================
# DashScope API Key（阿里云百炼平台的 API 密钥）
# 获取方式：登录阿里云百炼控制台 -> API-KEY 管理 -> 创建新的 API Key
# 文档：https://bailian.console.aliyun.com/?spm=5176.29597918.J_C-NDPSQ8SFKWB4aef8i6I.4.298d7b08IRr02o&tab=doc#/doc/?type=model&url=2877996
# 配置后可使用 configure_qwenvl3_api_key.py 脚本自动配置到数据库
DASHSCOPE_API_KEY=

# ============================================
# 代理配置（可选，如果需要）
# ============================================
# HTTP_PROXY=
# HTTPS_PROXY=
# NO_PROXY=localhost,127.0.0.1

