services:
  iot-gateway:
    image: iot-gateway:latest
    container_name: iot-gateway
    user: root
    network_mode: host # 使用host网络模式，直接使用宿主机网络
    environment:
      - TZ=Asia/Shanghai # 配置程序默认时区为上海（中国标准时间）
      - JAVA_OPTS=-Xms512m -Xmx512m
      - SPRING_PROFILES_ACTIVE=local # 指定程序运行环境
      - SPRING_CLOUD_NACOS_CONFIG_SERVER_ADDR=localhost:8848 # 配置中心地址（使用host网络模式，通过localhost访问）
      - SPRING_CLOUD_NACOS_CONFIG_NAMESPACE= # 使用默认命名空间（public）
      - SPRING_CLOUD_NACOS_SERVER_ADDR=localhost:8848 # 注册中心地址（使用host网络模式，通过localhost访问）
      - SPRING_CLOUD_NACOS_DISCOVERY_NAMESPACE= # 使用默认命名空间（public）
      # SkyWalking配置（如需要，请取消注释并配置）
      # - JAVA_TOOL_OPTIONS=-javaagent:/data/skywalking/skywalking-agent/skywalking-agent.jar
      # - SW_AGENT_NAME=iot-gateway
      # - SW_AGENT_TRACE_IGNORE_PATH=Redisson/PING,/actuator/**,/admin/**
      # - SW_AGENT_COLLECTOR_BACKEND_SERVICES=[YOUR_SKYWALKING_ADDR]
    volumes:
      - ${HOME}/docker/iot-device/logs:/root/logs/
      # - /data/skywalking/skywalking-agent:/data/skywalking/skywalking-agent
    restart: always

  iot-system:
    image: iot-module-system-biz:latest
    container_name: iot-system
    user: root
    environment:
      - TZ=Asia/Shanghai # 配置程序默认时区为上海（中国标准时间）
      - JAVA_OPTS=-Xms512m -Xmx512m
      - SPRING_PROFILES_ACTIVE=local # 指定程序运行环境
      - SPRING_CLOUD_NACOS_CONFIG_SERVER_ADDR=Nacos:8848 # 配置中心地址（使用Docker服务名）
      - SPRING_CLOUD_NACOS_CONFIG_NAMESPACE= # 使用默认命名空间（public）
      - SPRING_CLOUD_NACOS_SERVER_ADDR=Nacos:8848 # 注册中心地址（使用Docker服务名）
      - SPRING_CLOUD_NACOS_DISCOVERY_NAMESPACE= # 使用默认命名空间（public）
      - SPRING_DATASOURCE_DYNAMIC_DATASOURCE_MASTER_URL=jdbc:postgresql://PostgresSQL:5432/ruoyi-vue-pro20?autoReconnect=true&autoReconnectForPools=true&useUnicode=true&characterEncoding=utf8&createDatabaseIfNotExist=true&allowMultiQueries=true&zeroDateTimeBehavior=convertToNull&stringtype=unspecified # PostgreSQL数据库地址（使用Docker服务名）
      - SPRING_REDIS_HOST=Redis # Redis地址（使用Docker服务名）
      # SkyWalking配置（如需要，请取消注释并配置）
      # - JAVA_TOOL_OPTIONS=-javaagent:/data/skywalking/skywalking-agent/skywalking-agent.jar
      # - SW_AGENT_NAME=iot-system
      # - SW_AGENT_TRACE_IGNORE_PATH=Redisson/PING,/actuator/**,/admin/**
      # - SW_AGENT_COLLECTOR_BACKEND_SERVICES=[YOUR_SKYWALKING_ADDR]
    volumes:
      - ${HOME}/docker/iot-device/logs:/root/logs/
      # - /data/skywalking/skywalking-agent:/data/skywalking/skywalking-agent
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:48099"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 120s
    restart: always
    networks:
      - easyaiot-network

  iot-infra:
    image: iot-module-infra-biz:latest
    container_name: iot-infra
    user: root
    environment:
      - TZ=Asia/Shanghai # 配置程序默认时区为上海（中国标准时间）
      - JAVA_OPTS=-Xms512m -Xmx512m
      - SPRING_PROFILES_ACTIVE=local # 指定程序运行环境
      - SPRING_CLOUD_NACOS_CONFIG_SERVER_ADDR=Nacos:8848 # 配置中心地址（使用Docker服务名）
      - SPRING_CLOUD_NACOS_CONFIG_NAMESPACE= # 使用默认命名空间（public）
      - SPRING_CLOUD_NACOS_SERVER_ADDR=Nacos:8848 # 注册中心地址（使用Docker服务名）
      - SPRING_CLOUD_NACOS_DISCOVERY_NAMESPACE= # 使用默认命名空间（public）
      - SPRING_DATASOURCE_DYNAMIC_DATASOURCE_MASTER_URL=jdbc:postgresql://PostgresSQL:5432/ruoyi-vue-pro20?autoReconnect=true&autoReconnectForPools=true&useUnicode=true&characterEncoding=utf8&createDatabaseIfNotExist=true&allowMultiQueries=true&zeroDateTimeBehavior=convertToNull&stringtype=unspecified # PostgreSQL数据库地址（使用Docker服务名）
      - SPRING_REDIS_HOST=Redis # Redis地址（使用Docker服务名）
      - SPRING_RABBITMQ_HOST=localhost # RabbitMQ地址（如需要，请配置Docker服务名）
      - SPRING_KAFKA_BOOTSTRAP_SERVERS=Kafka:9092 # Kafka地址（使用Docker服务名）
      # SkyWalking配置（如需要，请取消注释并配置）
      # - JAVA_TOOL_OPTIONS=-javaagent:/data/skywalking/skywalking-agent/skywalking-agent.jar
      # - SW_AGENT_NAME=iot-infra
      # - SW_AGENT_TRACE_IGNORE_PATH=Redisson/PING,/actuator/**,/admin/**
      # - SW_AGENT_COLLECTOR_BACKEND_SERVICES=[YOUR_SKYWALKING_ADDR]
    volumes:
      - ${HOME}/docker/iot-device/logs:/root/logs/
      # - /data/skywalking/skywalking-agent:/data/skywalking/skywalking-agent
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:48082"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 120s
    restart: always
    networks:
      - easyaiot-network
    depends_on:
      iot-system:
        condition: service_healthy

  iot-device:
    image: iot-module-device-biz:latest
    container_name: iot-device
    user: root
    environment:
      - TZ=Asia/Shanghai # 配置程序默认时区为上海（中国标准时间）
      - JAVA_OPTS=-Xms512m -Xmx512m
      - SPRING_PROFILES_ACTIVE=local # 指定程序运行环境
      - SPRING_CLOUD_NACOS_CONFIG_SERVER_ADDR=Nacos:8848 # 配置中心地址（使用Docker服务名）
      - SPRING_CLOUD_NACOS_CONFIG_NAMESPACE= # 使用默认命名空间（public）
      - SPRING_CLOUD_NACOS_SERVER_ADDR=Nacos:8848 # 注册中心地址（使用Docker服务名）
      - SPRING_CLOUD_NACOS_DISCOVERY_NAMESPACE= # 使用默认命名空间（public）
      - SPRING_DATASOURCE_DYNAMIC_DATASOURCE_MASTER_URL=jdbc:postgresql://PostgresSQL:5432/iot-device20?autoReconnect=true&autoReconnectForPools=true&useUnicode=true&characterEncoding=utf8&createDatabaseIfNotExist=true&allowMultiQueries=true&zeroDateTimeBehavior=convertToNull&stringtype=unspecified # PostgreSQL数据库地址（使用Docker服务名）
      - SPRING_REDIS_HOST=Redis # Redis地址（使用Docker服务名）
      - MINIO_ENDPOINT=http://MinIO:9000 # Minio地址（使用Docker服务名）
      - SPRING_KAFKA_IOT_PRODUCER_BOOTSTRAP_SERVERS=Kafka:9092 # Kafka生产者地址（使用Docker服务名）
      - SPRING_KAFKA_IOT_CONSUMER_BOOTSTRAP_SERVERS=Kafka:9092 # Kafka消费者地址（使用Docker服务名）
      # SkyWalking配置（如需要，请取消注释并配置）
      # - JAVA_TOOL_OPTIONS=-javaagent:/data/skywalking/skywalking-agent/skywalking-agent.jar
      # - SW_AGENT_NAME=iot-device
      # - SW_AGENT_TRACE_IGNORE_PATH=Redisson/PING,/actuator/**,/admin/**
      # - SW_AGENT_COLLECTOR_BACKEND_SERVICES=[YOUR_SKYWALKING_ADDR]
    volumes:
      - ${HOME}/docker/iot-device/logs:/root/logs/
      # - /data/skywalking/skywalking-agent:/data/skywalking/skywalking-agent
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:48083"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 120s
    restart: always
    networks:
      - easyaiot-network
    depends_on:
      iot-infra:
        condition: service_healthy

  iot-dataset:
    image: iot-module-dataset-biz:latest
    container_name: iot-dataset
    user: root
    environment:
      - TZ=Asia/Shanghai # 配置程序默认时区为上海（中国标准时间）
      - JAVA_OPTS=-Xms512m -Xmx512m
      - SPRING_PROFILES_ACTIVE=local # 指定程序运行环境
      - SPRING_CLOUD_NACOS_CONFIG_SERVER_ADDR=Nacos:8848 # 配置中心地址（使用Docker服务名）
      - SPRING_CLOUD_NACOS_CONFIG_NAMESPACE= # 使用默认命名空间（public）
      - SPRING_CLOUD_NACOS_SERVER_ADDR=Nacos:8848 # 注册中心地址（使用Docker服务名）
      - SPRING_CLOUD_NACOS_DISCOVERY_NAMESPACE= # 使用默认命名空间（public）
      - SPRING_DATASOURCE_DYNAMIC_DATASOURCE_MASTER_URL=jdbc:postgresql://PostgresSQL:5432/iot-device20?autoReconnect=true&autoReconnectForPools=true&useUnicode=true&characterEncoding=utf8&createDatabaseIfNotExist=true&allowMultiQueries=true&zeroDateTimeBehavior=convertToNull&stringtype=unspecified # PostgreSQL数据库地址（使用Docker服务名）
      - SPRING_REDIS_HOST=Redis # Redis地址（使用Docker服务名）
      - MINIO_ENDPOINT=http://MinIO:9000 # Minio地址（使用Docker服务名）
      - MINIO_BASE_URL=http://MinIO:9000 # Minio基础URL（使用Docker服务名）
      # SkyWalking配置（如需要，请取消注释并配置）
      # - JAVA_TOOL_OPTIONS=-javaagent:/data/skywalking/skywalking-agent/skywalking-agent.jar
      # - SW_AGENT_NAME=iot-dataset
      # - SW_AGENT_TRACE_IGNORE_PATH=Redisson/PING,/actuator/**,/admin/**
      # - SW_AGENT_COLLECTOR_BACKEND_SERVICES=[YOUR_SKYWALKING_ADDR]
    volumes:
      - ${HOME}/docker/iot-device/logs:/root/logs/
      # - /data/skywalking/skywalking-agent:/data/skywalking/skywalking-agent
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:48087"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 120s
    restart: always
    networks:
      - easyaiot-network
    depends_on:
      iot-infra:
        condition: service_healthy

  iot-tdengine:
    image: iot-module-tdengine-biz:latest
    container_name: iot-tdengine
    user: root
    environment:
      - TZ=Asia/Shanghai # 配置程序默认时区为上海（中国标准时间）
      - JAVA_OPTS=-Xms512m -Xmx512m
      - SPRING_PROFILES_ACTIVE=local # 指定程序运行环境
      - SPRING_CLOUD_NACOS_CONFIG_SERVER_ADDR=Nacos:8848 # 配置中心地址（使用Docker服务名）
      - SPRING_CLOUD_NACOS_CONFIG_NAMESPACE= # 使用默认命名空间（public）
      - SPRING_CLOUD_NACOS_SERVER_ADDR=Nacos:8848 # 注册中心地址（使用Docker服务名）
      - SPRING_CLOUD_NACOS_DISCOVERY_NAMESPACE= # 使用默认命名空间（public）
      - SPRING_DATASOURCE_DYNAMIC_DATASOURCE_MASTER_URL=jdbc:TAOS-RS://TDengine:6041/iot_device?user=root&password=taosdata&useUnicode=true&characterEncoding=utf8&zeroDateTimeBehavior=convertToNull&useSSL=false&serverTimezone=GMT%2B8 # TDengine数据库地址（使用Docker服务名）
      - SPRING_REDIS_HOST=Redis # Redis地址（使用Docker服务名）
      # SkyWalking配置（如需要，请取消注释并配置）
      # - JAVA_TOOL_OPTIONS=-javaagent:/data/skywalking/skywalking-agent/skywalking-agent.jar
      # - SW_AGENT_NAME=iot-tdengine
      # - SW_AGENT_TRACE_IGNORE_PATH=Redisson/PING,/actuator/**,/admin/**
      # - SW_AGENT_COLLECTOR_BACKEND_SERVICES=[YOUR_SKYWALKING_ADDR]
    volumes:
      - ${HOME}/docker/iot-device/logs:/root/logs/
      # - /data/skywalking/skywalking-agent:/data/skywalking/skywalking-agent
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:48091"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 120s
    restart: always
    networks:
      - easyaiot-network
    depends_on:
      iot-infra:
        condition: service_healthy

  iot-file:
    image: iot-module-file-biz:latest
    container_name: iot-file
    user: root
    environment:
      - TZ=Asia/Shanghai # 配置程序默认时区为上海（中国标准时间）
      - JAVA_OPTS=-Xms512m -Xmx512m
      - SPRING_PROFILES_ACTIVE=local # 指定程序运行环境
      - SPRING_CLOUD_NACOS_CONFIG_SERVER_ADDR=Nacos:8848 # 配置中心地址（使用Docker服务名）
      - SPRING_CLOUD_NACOS_CONFIG_NAMESPACE= # 使用默认命名空间（public）
      - SPRING_CLOUD_NACOS_SERVER_ADDR=Nacos:8848 # 注册中心地址（使用Docker服务名）
      - SPRING_CLOUD_NACOS_DISCOVERY_NAMESPACE= # 使用默认命名空间（public）
      - SPRING_DATASOURCE_DYNAMIC_DATASOURCE_MASTER_URL=jdbc:postgresql://PostgresSQL:5432/ruoyi-vue-pro20?autoReconnect=true&autoReconnectForPools=true&useUnicode=true&characterEncoding=utf8&createDatabaseIfNotExist=true&allowMultiQueries=true&zeroDateTimeBehavior=convertToNull&stringtype=unspecified # PostgreSQL数据库地址（使用Docker服务名）
      - SPRING_REDIS_HOST=Redis # Redis地址（使用Docker服务名）
      - MINIO_URL=http://MinIO:9000 # Minio地址（使用Docker服务名）
      - MINIO_DOWNLOAD_URL=http://MinIO:9001 # Minio下载地址（使用Docker服务名）
      # SkyWalking配置（如需要，请取消注释并配置）
      # - JAVA_TOOL_OPTIONS=-javaagent:/data/skywalking/skywalking-agent/skywalking-agent.jar
      # - SW_AGENT_NAME=iot-file
      # - SW_AGENT_TRACE_IGNORE_PATH=Redisson/PING,/actuator/**,/admin/**
      # - SW_AGENT_COLLECTOR_BACKEND_SERVICES=[YOUR_SKYWALKING_ADDR]
    volumes:
      - ${HOME}/docker/iot-device/logs:/root/logs/
      # - /data/skywalking/skywalking-agent:/data/skywalking/skywalking-agent
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:48090"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 120s
    restart: always
    networks:
      - easyaiot-network
    depends_on:
      iot-infra:
        condition: service_healthy

  iot-message:
    image: iot-module-message-biz:latest
    container_name: iot-message
    user: root
    environment:
      - TZ=Asia/Shanghai # 配置程序默认时区为上海（中国标准时间）
      - JAVA_OPTS=-Xms512m -Xmx512m
      - SPRING_PROFILES_ACTIVE=local # 指定程序运行环境
      - SPRING_CLOUD_NACOS_CONFIG_SERVER_ADDR=Nacos:8848 # 配置中心地址（使用Docker服务名）
      - SPRING_CLOUD_NACOS_CONFIG_NAMESPACE= # 使用默认命名空间（public）
      - SPRING_CLOUD_NACOS_SERVER_ADDR=Nacos:8848 # 注册中心地址（使用Docker服务名）
      - SPRING_CLOUD_NACOS_DISCOVERY_NAMESPACE= # 使用默认命名空间（public）
      - SPRING_DATASOURCE_DYNAMIC_DATASOURCE_MASTER_URL=jdbc:postgresql://PostgresSQL:5432/iot-message20?autoReconnect=true&autoReconnectForPools=true&useUnicode=true&characterEncoding=utf8&createDatabaseIfNotExist=true&allowMultiQueries=true&zeroDateTimeBehavior=convertToNull&stringtype=unspecified # PostgreSQL数据库地址（使用Docker服务名）
      - SPRING_DATASOURCE_DYNAMIC_DATASOURCE_MASTER_USERNAME=postgres # PostgreSQL数据库用户名
      - SPRING_DATASOURCE_DYNAMIC_DATASOURCE_MASTER_PASSWORD=iot45722414822 # PostgreSQL数据库密码
      - SPRING_DATASOURCE_DYNAMIC_DATASOURCE_VIDEO_URL=jdbc:postgresql://PostgresSQL:5432/iot-video20?autoReconnect=true&autoReconnectForPools=true&useUnicode=true&characterEncoding=utf8&allowMultiQueries=true&zeroDateTimeBehavior=convertToNull&stringtype=unspecified # VIDEO数据库地址（使用Docker服务名）
      - SPRING_DATASOURCE_DYNAMIC_DATASOURCE_VIDEO_USERNAME=postgres # VIDEO数据库用户名
      - SPRING_DATASOURCE_DYNAMIC_DATASOURCE_VIDEO_PASSWORD=iot45722414822 # VIDEO数据库密码
      - SPRING_REDIS_HOST=Redis # Redis地址（使用Docker服务名）
      - SPRING_KAFKA_BOOTSTRAP_SERVERS=Kafka:9092 # Kafka地址（使用Docker服务名）
      - MINIO_ENDPOINT=http://MinIO # Minio地址（使用Docker服务名）
      - MINIO_PORT=9000 # Minio端口
      # SkyWalking配置（如需要，请取消注释并配置）
      # - JAVA_TOOL_OPTIONS=-javaagent:/data/skywalking/skywalking-agent/skywalking-agent.jar
      # - SW_AGENT_NAME=iot-message
      # - SW_AGENT_TRACE_IGNORE_PATH=Redisson/PING,/actuator/**,/admin/**
      # - SW_AGENT_COLLECTOR_BACKEND_SERVICES=[YOUR_SKYWALKING_ADDR]
    volumes:
      - ${HOME}/docker/iot-device/logs:/root/logs/
      # - /data/skywalking/skywalking-agent:/data/skywalking/skywalking-agent
    # 配置hosts映射，将kafka-server映射到宿主机IP
    # 使用host-gateway自动解析为宿主机IP（Docker 20.10+支持）
    # 如果host-gateway不工作，可以手动指定IP，例如：- "kafka-server:192.168.1.100"
    extra_hosts:
      - "kafka-server:host-gateway"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:48093"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 120s
    restart: always
    networks:
      - easyaiot-network
    depends_on:
      iot-infra:
        condition: service_healthy

  iot-sink:
    image: iot-sink-biz:latest
    container_name: iot-sink
    user: root
    environment:
      - TZ=Asia/Shanghai # 配置程序默认时区为上海（中国标准时间）
      - JAVA_OPTS=-Xms512m -Xmx512m
      - SPRING_PROFILES_ACTIVE=local # 指定程序运行环境
      - SPRING_CLOUD_NACOS_CONFIG_SERVER_ADDR=Nacos:8848 # 配置中心地址（使用Docker服务名）
      - SPRING_CLOUD_NACOS_CONFIG_NAMESPACE= # 使用默认命名空间（public）
      - SPRING_CLOUD_NACOS_SERVER_ADDR=Nacos:8848 # 注册中心地址（使用Docker服务名）
      - SPRING_CLOUD_NACOS_DISCOVERY_NAMESPACE= # 使用默认命名空间（public）
      - SPRING_DATASOURCE_DYNAMIC_DATASOURCE_MASTER_URL=jdbc:postgresql://PostgresSQL:5432/iot-device20?autoReconnect=true&autoReconnectForPools=true&useUnicode=true&characterEncoding=utf8&createDatabaseIfNotExist=true&allowMultiQueries=true&zeroDateTimeBehavior=convertToNull&stringtype=unspecified # PostgreSQL数据库地址（使用Docker服务名）
      - SPRING_DATASOURCE_DYNAMIC_DATASOURCE_TDENGINE_URL=jdbc:TAOS-RS://TDengine:6041/iot_device?user=root&password=taosdata&useUnicode=true&characterEncoding=utf8&zeroDateTimeBehavior=convertToNull&useSSL=false&serverTimezone=GMT%2B8 # TDengine数据库地址（使用Docker服务名）
      - SPRING_DATASOURCE_DYNAMIC_DATASOURCE_VIDEO_URL=jdbc:postgresql://PostgresSQL:5432/iot-video20?autoReconnect=true&autoReconnectForPools=true&useUnicode=true&characterEncoding=utf8&allowMultiQueries=true&zeroDateTimeBehavior=convertToNull&stringtype=unspecified # VIDEO数据库地址（使用Docker服务名）
      - SPRING_REDIS_HOST=Redis # Redis地址（使用Docker服务名）
      - SPRING_KAFKA_BOOTSTRAP_SERVERS=Kafka:9092 # Kafka地址（使用Docker服务名，用于标准配置）
      - SPRING_KAFKA_IOT_PRODUCER_BOOTSTRAP_SERVERS=Kafka:9092 # Kafka生产者地址（使用Docker服务名，用于自定义iot配置）
      - SPRING_KAFKA_IOT_CONSUMER_BOOTSTRAP_SERVERS=Kafka:9092 # Kafka消费者地址（使用Docker服务名，用于自定义iot配置）
      # SkyWalking配置（如需要，请取消注释并配置）
      # - JAVA_TOOL_OPTIONS=-javaagent:/data/skywalking/skywalking-agent/skywalking-agent.jar
      # - SW_AGENT_NAME=iot-sink
      # - SW_AGENT_TRACE_IGNORE_PATH=Redisson/PING,/actuator/**,/admin/**
      # - SW_AGENT_COLLECTOR_BACKEND_SERVICES=[YOUR_SKYWALKING_ADDR]
    volumes:
      - ${HOME}/docker/iot-device/logs:/root/logs/
      # - /data/skywalking/skywalking-agent:/data/skywalking/skywalking-agent
    # 配置hosts映射，将kafka-server映射到宿主机IP
    # 使用host-gateway自动解析为宿主机IP（Docker 20.10+支持）
    # 如果host-gateway不工作，可以手动指定IP，例如：- "kafka-server:192.168.1.100"
    extra_hosts:
      - "kafka-server:host-gateway"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:48092"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 120s
    restart: always
    networks:
      - easyaiot-network
    depends_on:
      iot-infra:
        condition: service_healthy

  iot-gb28181:
    image: iot-gb28181-biz:latest
    container_name: iot-gb28181
    user: root
    network_mode: host # 使用host网络模式，直接使用宿主机网络（GB28181需要直接访问网络）
    environment:
      - TZ=Asia/Shanghai # 配置程序默认时区为上海（中国标准时间）
      - JAVA_OPTS=-Xms512m -Xmx512m
      - SPRING_PROFILES_ACTIVE=local # 指定程序运行环境
      - SPRING_CLOUD_NACOS_CONFIG_SERVER_ADDR=localhost:8848 # 配置中心地址（使用host网络模式，通过localhost访问）
      - SPRING_CLOUD_NACOS_CONFIG_NAMESPACE= # 使用默认命名空间（public）
      - SPRING_CLOUD_NACOS_SERVER_ADDR=localhost:8848 # 注册中心地址（使用host网络模式，通过localhost访问）
      - SPRING_CLOUD_NACOS_DISCOVERY_NAMESPACE= # 使用默认命名空间（public）
      - SPRING_DATASOURCE_DYNAMIC_DATASOURCE_MASTER_URL=jdbc:postgresql://PostgresSQL:5432/iot-gb2818120?autoReconnect=true&autoReconnectForPools=true&useUnicode=true&characterEncoding=utf8&createDatabaseIfNotExist=true&allowMultiQueries=true&zeroDateTimeBehavior=convertToNull&stringtype=unspecified # PostgreSQL数据库地址（使用Docker服务名，通过extra_hosts映射）
      - SPRING_REDIS_HOST=Redis # Redis地址（使用Docker服务名，通过extra_hosts映射）
      # SkyWalking配置（如需要，请取消注释并配置）
      # - JAVA_TOOL_OPTIONS=-javaagent:/data/skywalking/skywalking-agent/skywalking-agent.jar
      # - SW_AGENT_NAME=iot-gb28181
      # - SW_AGENT_TRACE_IGNORE_PATH=Redisson/PING,/actuator/**,/admin/**
      # - SW_AGENT_COLLECTOR_BACKEND_SERVICES=[YOUR_SKYWALKING_ADDR]
    volumes:
      - ${HOME}/docker/iot-device/logs:/root/logs/
      # - /data/skywalking/skywalking-agent:/data/skywalking/skywalking-agent
    # 配置hosts映射，将PostgresSQL和Redis映射到宿主机IP（使用host-gateway自动解析为宿主机IP）
    # 这样使用host网络模式的服务可以通过服务名访问Docker网络中的服务
    extra_hosts:
      - "PostgresSQL:host-gateway"
      - "Redis:host-gateway"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:48088"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 120s
    restart: always

networks:
  easyaiot-network:
    name: easyaiot-network
    external: true
